<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teams Recordings</title>
<script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
<style>
/* --- ALL YOUR ORIGINAL CSS UNCHANGED --- */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:#f5f5f5;}
.app-container{display:flex;min-height:100vh;}
.sidebar{width:260px;background:#2c3e50;color:white;}
.sidebar-header{padding:20px;background:#34495e;display:flex;justify-content:space-between;align-items:center;}
.sidebar-header h2{font-size:18px;}
.profile-icon{width:36px;height:36px;background:#3498db;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.profile-icon:hover{background:#2980b9;}
.profile-dropdown{position:absolute;top:50px;right:10px;background:white;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.2);min-width:220px;z-index:1000;display:none;}
.profile-dropdown.show{display:block;}
.profile-info{padding:15px;border-bottom:1px solid #eee;}
.profile-info h4{color:#333;margin-bottom:4px;}
.profile-info p{color:#666;font-size:12px;}
.profile-action{padding:12px 15px;}
.sidebar-nav{padding:20px 0;}
.nav-item{display:block;width:100%;padding:14px 20px;background:none;border:none;color:white;text-align:left;cursor:pointer;font-size:15px;transition:background 0.2s;}
.nav-item:hover{background:#34495e;}
.nav-item.active{background:#3498db;}
.main-content{flex:1;padding:30px;}
.content-section{display:none;}
.content-section.active{display:block;}
.section-header{margin-bottom:25px;}
.section-header h1{color:#2c3e50;font-size:26px;margin-bottom:8px;}
.section-header p{color:#7f8c8d;}
.btn{background:#3498db;color:white;border:none;padding:12px 24px;border-radius:6px;cursor:pointer;font-size:14px;}
.btn:hover{background:#2980b9;}
.item-card{background:#f8f9fa;padding:15px;margin-bottom:12px;border-radius:6px;border-left:4px solid #3498db;}
.item-title{font-weight:600;color:#2c3e50;margin-bottom:6px;}
.item-meta{color:#7f8c8d;font-size:13px;margin-bottom:10px;}
.loading{text-align:center;padding:40px;color:#7f8c8d;}
.error-msg{background:#f8d7da;color:#721c24;padding:15px;border-radius:6px;margin-bottom:15px;}
</style>
</head>
<body>

<div class="app-container">
<main class="main-content">
<section id="recordings" class="content-section active">
<div class="section-header">
<h1>Recordings</h1>
<p>Teams recordings from your specific folder</p>
</div>

<div class="card">
<button class="btn" onclick="loadRecordings()">Refresh Recordings</button>
<div id="recordingsList" style="margin-top:20px;">
<p class="loading">Click Refresh to load recordings...</p>
</div>
</div>
</section>
</main>
</div>

<script>

/* ---------------- MSAL CONFIG UNCHANGED ---------------- */

const msalConfig = {
auth: {
clientId: "4dc5efa6-49cb-4991-9cbf-1867596a2110",
authority: "https://login.microsoftonline.com/abd34cc0-2911-44eb-abea-713c02c9b3e8",
redirectUri: window.location.origin + window.location.pathname
},
cache:{cacheLocation:"localStorage",storeAuthStateInCookie:true}
};

const msalInstance = new msal.PublicClientApplication(msalConfig);
let currentAccount = null;

async function initializeMsal(){
const response = await msalInstance.handleRedirectPromise();
if(response){currentAccount=response.account;msalInstance.setActiveAccount(currentAccount);}
else{
const accounts=msalInstance.getAllAccounts();
if(accounts.length>0){currentAccount=accounts[0];msalInstance.setActiveAccount(currentAccount);}
}
}
initializeMsal();

async function getToken(){
if(!currentAccount){
const accounts=msalInstance.getAllAccounts();
if(accounts.length>0){currentAccount=accounts[0];}
else{await msalInstance.loginRedirect({scopes:["User.Read","Files.Read.All"]});return;}
}
const response=await msalInstance.acquireTokenSilent({
scopes:["User.Read","Files.Read.All"],
account:currentAccount
});
return response.accessToken;
}

async function callGraph(endpoint){
const token=await getToken();
if(!token)return null;
const response=await fetch("https://graph.microsoft.com/v1.0"+endpoint,{
headers:{"Authorization":"Bearer "+token}
});
if(!response.ok)throw new Error("Graph API error: "+response.status);
return response.json();
}

/* ================== ðŸ”¥ UPDATED RECORDINGS FUNCTION ================== */

async function loadRecordings(){

const container=document.getElementById("recordingsList");
container.innerHTML='<p class="loading">Loading recordings...</p>';

try{

// ðŸ”¥ LIST FILES INSIDE YOUR SPECIFIC FOLDER
const folderId="015RM5L7QFJSFG3HT6M5E3V2GSYMRC45PL";

const data=await callGraph(
`/me/drive/items/${folderId}/children?$select=id,name,size,webUrl,lastModifiedDateTime`
);

if(!data||!data.value||data.value.length===0){
container.innerHTML='<p>No recordings found inside folder.</p>';
return;
}

const recordings=data.value.filter(f=>f.name.toLowerCase().endsWith(".mp4"));

container.innerHTML=recordings.map(r=>{

const size=(r.size/1024/1024).toFixed(1)+" MB";
const date=new Date(r.lastModifiedDateTime).toLocaleString();

return `
<div class="item-card">

<div class="item-title">${r.name}</div>

<div style="font-size:12px;color:#444;margin-bottom:6px;">
<strong>Item ID:</strong><br>
${r.id}
</div>

<div class="item-meta">
Size: ${size} | Date: ${date}
</div>

<a href="${r.webUrl}" target="_blank" class="btn">
Open in OneDrive
</a>

</div>
`;

}).join("");

}catch(error){
container.innerHTML='<div class="error-msg">Error: '+error.message+'</div>';
}
}

</script>
</body>
</html>
